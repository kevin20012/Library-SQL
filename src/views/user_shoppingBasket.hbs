<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>장바구니</title>
		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<style>
			body { font-family: Arial, sans-serif; } .container { margin-top:
			30px; } .table th { background-color: #f8f9fa; font-weight: bold; }
			.no-data { text-align: center; font-size: 1.2rem; color: #6c757d; }
			.navbar-custom { background-color: #f8f9fa; border-bottom: 1px solid
			#e5e5e5; } .user-info { font-size: 1.2rem; font-weight: bold;
			}.totalprice { font-size: 1.2rem; font-weight: bold;
			margin-right:10px; text-decoration: underline;} .navbar-custom
			a.navbar-brand { text-decoration: none; color: #343a40; display:
			flex; align-items: center; font-size: 1rem; } .navbar-custom
			a.navbar-brand:hover { color: #0d6efd; } td { vertical-align:
			middle; text-align: center; }/* 테두리 제거 */ .table-bordered
			.no-border { border: none !important; /* 테두리 완전히 제거 */
			background-color: transparent !important; /* 배경색 제거 */ } /*
			버튼 주변에 불필요한 공간 제거 */ .no-border button { margin: 0;
			padding: 5px 10px; }
		</style>
		<script>
			document.addEventListener('DOMContentLoaded', () => { function
			purchaseFetch() { const BasketID =
			document.querySelector('#BasketID').value; const data = { BasketID:
			BasketID }; fetch("/main/shoppingBasket/purchase", { method: 'POST',
			headers: { 'Content-Type': 'application/json' }, body:
			JSON.stringify(data), }).then(response => { if (response.ok) {
			alert('구매 성공!');location.href='/main/shoppingBasket/'; } else {
			alert('구매 실패!');location.href='/main/shoppingBasket/'; } })
			.catch(error => { console.error('Error:', error); }); }
			document.querySelector('.btn-primary').addEventListener('click',
			purchaseFetch); });
		</script>
	</head>
	<body>
		<!-- Navigation Bar -->
		<nav class="navbar navbar-expand-lg navbar-custom">
			<div class="container-fluid">
				<!-- User Info -->
				<div class="d-flex align-items-center user-info">
					<a href="/main" class="navbar-brand">
						<span class="me-2">←</span>
					</a>
					<span id="user-name">{{user.name}} 님의 장바구니 🛒</span>
				</div>
				<!-- Right-side Buttons -->
				{{#if shoppingBasket.length}}
					<div class="navbar-buttons ms-auto">
						<span style="font-weight:bold;">합계:</span>
						<span class="totalprice">{{totalPrice}}$</span>
						<button
							class="btn btn-primary"
							onclick="purchaseFetch()"
						>구매하기</button>
					</div>
				{{/if}}
			</div>
		</nav>
		<div class="container">
			<!-- 장바구니 표 -->
			{{#if shoppingBasket.length}}
				<table class="table table-bordered table-striped text-center">
					<thead>
						<tr>
							<th>ISBN</th>
							<th>제목</th>
							<th>수량</th>
							<th>개당 가격</th>
							<th>삭제</th>
						</tr>
					</thead>
					<tbody>
						{{#each shoppingBasket}}
							<tr id="shoppingItem">
								<form method="post">
									<td style="display:none;"><input
											type="text"
											name="BasketID"
											id="BasketID"
											class="form-control"
											value="{{BasketID}}"
										/></td>
									<td style="display:none;"><input
											type="text"
											name="ISBN"
											class="form-control"
											value="{{ISBN}}"
										/></td>
									<td style="display:none;"><input
											type="text"
											name="Number"
											class="form-control"
											value="{{Number}}"
										/></td>
									<td>{{ISBN}}</td>
									<td>{{Title}}</td>
									<td>{{Number}}</td>
									<td>{{Price}}$</td>
									<td>
										<button
											type="submit"
											class="btn btn-danger"
											formaction="/main/shoppingBasket/delete"
										>삭제</button>
									</td>
								</form>
							</tr>
						{{/each}}
					</tbody>
				</table>
				<!-- Pagination -->
				<nav
					aria-label="Page navigation"
					class="d-flex justify-content-center mt-4"
				>
					<ul class="pagination">
						<li class="page-item">
							<a
								class="page-link"
								href="/main/basket?page=1"
							>&laquo;</a>
						</li>
						<li class="page-item">
							<a
								class="page-link"
								href="/main/basket?page={{pageInfo.prevPage}}"
							>이전</a>
						</li>
						{{#each Page}}
							<li class="page-item">
								<a
									class="page-link"
									href="/main/basket?page={{this}}"
								>{{this}}</a>
							</li>
						{{/each}}
						<li class="page-item">
							<a
								class="page-link"
								href="/main/basket?page={{pageInfo.nextPage}}"
							>다음</a>
						</li>
						<li class="page-item">
							<a
								class="page-link"
								href="/main/basket?page={{pageInfo.totalPages}}"
							>&raquo;</a>
						</li>
					</ul>
				</nav>
			{{else}}
				<p class="no-data">장바구니가 비어 있습니다.</p>
			{{/if}}
		</div>

		<!-- Bootstrap JS -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		></script>
	</body>
</html>