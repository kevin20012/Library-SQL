<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>메인홈</title>
		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<style>
			body { font-family: "Arial", sans-serif; } .navbar-custom {
			background-color: #f8f9fa; border-bottom: 1px solid #e5e5e5; }
			.user-info { font-size: 1.2rem; font-weight: bold; } .search-bar {
			max-width: 500px; margin: 0 auto; } .navbar-buttons { display: flex;
			gap: 10px; } table { width: 100%; margin-top: 20px; border-collapse:
			collapse; } th, td { padding: 10px; text-align: left; border: 1px
			solid #ddd; } th { background-color: #f4f4f4; font-weight: bold; }.card-body {
				display: flex;
				flex-direction: column;
				justify-content: space-between;
			}
			.card-buttons {
				margin-top: auto; /* 버튼들을 하단에 배치 */
			}
			/* 카드 기본 설정 */

			/* 숨겨진 컨텐츠 */
			.hover-content {
				position: absolute; /* 부모를 기준으로 위치 설정 */
				bottom: 15px; /* 카드 하단에 고정 */
				left: 15px; /* 카드 좌측 여백 */
				right: 15px; /* 카드 우측 여백 */
				display: flex; /* 정렬을 위해 flex 사용 */
				flex-direction: column; /* 수직 정렬 */
				align-items: flex-end; /* 내부 요소를 오른쪽으로 정렬 */
				gap: 10px; /* 요소 간 간격 */
				background-color: transparent; /* 겹침 방지를 위해 배경색 설정 */
				padding: 10px; /* 여백 추가 */
			}

			/* 버튼 스타일 */
			.btn-sm {
				padding: 5px 10px;
				font-size: 0.9rem;
			}

		</style>
		<script>
			// 수량 조정
			function updateQuantity(index, change) {
				const quantityElement = document.getElementById(`quantity-${index}`);
				const selectedQuantityElement = document.getElementById(`selected-quantity-${index}`);
				const reservInputQuantityElement = document.getElementById(`selected-quantity-reservation-${index}`);
				const cartInputQuantityElement = document.getElementById(`selected-quantity-cart-${index}`);

				
				// 현재 남은 수량 가져오기
				const availableQuantity = parseInt(quantityElement.innerText);
				const selectedQuantity = parseInt(selectedQuantityElement.innerText);
				
				// 변경된 수량 계산
				const newQuantity = selectedQuantity + change;
				const restQuantity = availableQuantity - change
				
				if (newQuantity >= 0 && restQuantity>=0) {
					selectedQuantityElement.innerText = newQuantity;
					reservInputQuantityElement.value = newQuantity;
					cartInputQuantityElement.value = newQuantity;
					quantityElement.innerText = restQuantity;
				}
			}
			let currentIndex; // 현재 예약한 책의 인덱스를 저장

			// 모달 열기
			function openPickupModal(index) {
				currentIndex = index; // 현재 클릭한 카드의 인덱스를 저장
				const modal = new bootstrap.Modal(document.getElementById(`pickupModal-${index}`));
				modal.show();
			}

			// 픽업 시간 확인 버튼 클릭 시 동작
			function cancelPickupModal(index) {
				const modal = bootstrap.Modal.getInstance(document.getElementById(`pickupModal-${index}`));
				modal.hide();
			}
		</script>
	</head>
	<body>
		<!-- Navigation Bar -->
		<nav class="navbar navbar-expand-lg navbar-custom">
			<div class="container-fluid">
				<!-- User Info -->
				<div class="d-flex align-items-center user-info">
					<span id="user-name">INHA Library</span>
				</div>

				<!-- Right-side Buttons -->
				<div class="navbar-buttons ms-auto">
					<a href="/main/reservation" class="btn btn-primary">예약
						확인</a>
					<a
						href="/main/shoppingBasket"
						class="btn btn-secondary"
					>장바구니</a>
				</div>
			</div>
		</nav>

		<!-- Main Content -->
		<div class="container mt-4">
			<!-- Welcome Message -->
			<h1>안녕하세요! {{user.name}} 님</h1>
			<p>책을 검색해보세요. 책, 작가, 수상기록을 이용해 책을 검색할 수
				있습니다.</p>

			<!-- Center Search Bar -->
			<!-- Center Search Bar -->
			<form
				class="d-flex flex-column align-items-start search-bar"
				action="/main/search"
				method="get"
			>
				<!-- Radio Buttons -->
				<div class="d-flex mb-3">
				<div class="form-check form-check-inline">
					<input
						class="form-check-input"
						type="radio"
						name="option"
						id="option1"
						value="book"
						{{#if (eq option "book")}}checked{{/if}}
					/>
					<label class="form-check-label" for="option1">책 제목</label>
				</div>
				<div class="form-check form-check-inline">
					<input
						class="form-check-input"
						type="radio"
						name="option"
						id="option2"
						value="author"
						{{#if (eq option "author")}}checked{{/if}}
					/>
					<label class="form-check-label" for="option2">작가 이름</label>
				</div>
				<div class="form-check form-check-inline">
					<input
						class="form-check-input"
						type="radio"
						name="option"
						id="option3"
						value="award"
						{{#if (eq option "award")}}checked{{/if}}
					/>
					<label class="form-check-label" for="option3">수상</label>
				</div>
			</div>

				<!-- Search Input -->
				<div class="d-flex align-items-center">
					<input
						class="form-control"
						type="search"
						name="query"
						placeholder="Search for books, authors..."
						aria-label="Search"
						style="width: 400px;"
						value="{{query}}"
					/>
					<button
						class="btn btn-outline-primary ms-2"
						type="submit"
					>Search</button>
				</div>
			</form>

			<!-- Search Results -->
			{{#if searchResults}}
				<h2 class="mt-4">검색 결과</h2>
				<p class="text-muted">Page {{pageInfo.currentPage}} of {{pageInfo.totalPages}} (Total: {{pageInfo.totalCount}})</p>
				<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
					{{#each searchResults}}
					<div class="col">
						<div class="card h-100 shadow-sm card-hover">
							<div class="card-body d-flex flex-column">
								<h4 class="card-title text-primary">{{Title}}</h4>
								<p class="card-text">
									<strong>작가:</strong> {{Author}}<br />
									<strong>ISBN:</strong> {{ISBN}}<br />
									<strong>분류:</strong> {{Category}}<br />
									<strong>수상내역:</strong> {{Award}}<br />
									<strong>연도:</strong> {{Year}}<br />
									<strong>가격:</strong> {{Price}}$<br />
									<strong>남은 수량:</strong> <span style="text-decoration: underline; color:rgb(20, 87, 220)" id="quantity-{{@index}}" class="quantity-value">{{Quantity}}</span>
								</p>
								<div class="hover-content">
									<!-- 수량 조절 -->
									<div class="d-flex align-items-center mt-auto">
										<button 
											class="btn btn-sm btn-outline-secondary" 
											onclick="updateQuantity({{@index}}, -1)"
										>-</button>
										<span class="mx-2" id="selected-quantity-{{@index}}">0</span>
										<button 
											class="btn btn-sm btn-outline-secondary" 
											onclick="updateQuantity({{@index}}, 1)"
										>+</button>
									</div>
									<!-- 버튼 -->
									<div class="d-flex align-items-center flex-start mt-3">
										<form action="/main/reservation/addReservation" method="post" style="margin-right: 10px;">
											<input type="hidden" name="ISBN" value="{{ISBN}}">
											<input type="hidden" id="selected-quantity-reservation-{{@index}}" name="quantity" value="0">
											<button type="button" class="btn btn-primary" onclick="openPickupModal({{@index}})">예약</button>
											<!-- 모달 -->
											<div class="modal fade" id="pickupModal-{{@index}}" tabindex="-1" aria-labelledby="pickupModalLabel" aria-hidden="true">
												<div class="modal-dialog">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title" id="pickupModalLabel">픽업 시간 입력</h5>
															<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
														</div>
														<div class="modal-body">
															<label for="pickupTimeInput">픽업 시간을 입력하세요:</label>
															<input type="datetime-local" name="pickupTimeInput" id="pickupTimeInput" class="form-control">
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="cancelPickupModal({{@index}})">취소</button>
															<button type="submit" class="btn btn-primary">확인</button>
														</div>
													</div>
												</div>
											</div>
										</form>
										<form action="/main/shoppingBasket/addShoppingBasket" method="post">
											<input type="hidden" name="ISBN" value="{{ISBN}}">
											<input type="hidden" id="selected-quantity-cart-{{@index}}" name="quantity" value="0">
											<button type="submit" class="btn btn-secondary">장바구니 담기</button>
										</form>
									</div>
								</div>	
							</div>
						</div>
					</div>
					{{/each}}
				</div>
				<!-- Pagination -->
				<nav aria-label="Page navigation" class="d-flex justify-content-center mt-4">
					<ul class="pagination">
						<li class="page-item">
							<a
								class="page-link"
								href="/main/search?page=1&option={{option}}&query={{query}}"
							>&laquo;</a>
						</li>
						<li class="page-item">
							<a
								class="page-link"
								href="/main/search?page={{pageInfo.prevPage}}&option={{option}}&query={{query}}"
							>이전</a>
						</li>
						{{#each Page}}
						<li class="page-item">
							<a
								class="page-link"
								href="/main/search?page={{this}}&option={{../option}}&query={{../query}}"
							>{{this}}</a>
						</li>
						{{/each}}
						<li class="page-item">
							<a
								class="page-link"
								href="/main/search?page={{pageInfo.nextPage}}&option={{option}}&query={{query}}"
							>다음</a>
						</li>
						<li class="page-item">
							<a
								class="page-link"
								href="/main/search?page={{pageInfo.totalPages}}&option={{option}}&query={{query}}"
							>&raquo;</a>
						</li>
					</ul>
				</nav>
			{{else}}
				<p class="mt-4 text-center text-muted">검색 결과가 없습니다. 다른 키워드로 검색해보세요.</p>
			{{/if}}
		</div>

		<!-- Bootstrap JS -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		></script>
	</body>
</html>