<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>구매 이력</title>
		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<style>
			body { font-family: Arial, sans-serif; } .container { margin-top:
			30px; } .table th { background-color: #f8f9fa; font-weight: bold; }
			.table td, .table th { vertical-align: middle !important; /* 수직
			정렬 가운데로 설정 */ } .no-data { text-align: center; font-size:
			1.2rem; color: #6c757d; } .navbar-custom { background-color:
			#f8f9fa; border-bottom: 1px solid #e5e5e5; } .user-info { font-size:
			1.2rem; font-weight: bold; } .navbar-custom a.navbar-brand {
			text-decoration: none; color: #343a40; display: flex; align-items:
			center; font-size: 1rem; } .navbar-custom a.navbar-brand:hover {
			color: #0d6efd; } .navbar-custom .fs-1 { font-size: 2rem;
			margin-right: 10px; }
		</style>
	</head>
	<body>
		<!-- Navigation Bar -->
		<nav class="navbar navbar-expand-lg navbar-custom">
			<div class="container-fluid">
				<!-- User Info -->
				<div class="d-flex align-items-center user-info">
					<a href="/main" class="navbar-brand">
						<span class="me-2">←</span>
					</a>
					<span id="user-name">{{user.name}} 님 구매 이력 💸</span>
				</div>
			</div>
		</nav>

		<div class="container">
			<!-- 구매 이력 표 -->
			{{#if orders.length}}
				<table class="table table-bordered table-striped text-center">
					<thead>
						<tr>
							<th>구매 ID</th>
							<th>구매 날짜</th>
							<th>상태</th>
							<th>자세히 보기</th>
						</tr>
					</thead>
					<tbody>
						{{#each orders}}
							<tr>
								<td>{{BasketID}}</td>
								<td>{{Order_date}}</td>
								<td><span class="badge bg-success">구매 완료</span></td>
								<td>
									<button
										class="btn btn-info"
										onclick="fetchOrderDetails('{{BasketID}}')"
										data-bs-toggle="modal"
										data-bs-target="#orderModal"
									>보기</button>
								</td>
							</tr>
						{{/each}}
					</tbody>
				</table>
			{{else}}
				<p class="no-data">구매 이력이 없습니다.</p>
			{{/if}}
		</div>

		<!-- Modal -->
		<div
			class="modal fade"
			id="orderModal"
			tabindex="-1"
			aria-labelledby="orderModalLabel"
			aria-hidden="true"
		>
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="orderModalLabel">구매 상세
							정보</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<table class="table table-bordered text-center">
							<thead>
								<tr>
									<th>Book ISBN</th>
									<th>제목</th>
									<th>수량</th>
									<th>개당 가격</th>
								</tr>
							</thead>
							<tbody id="order-details">
								<!-- 책 정보가 동적으로 채워질 영역 -->
							</tbody>
						</table>
						<div
							id="total-price"
							style="text-align: right; margin-right: 20px;"
						>합계: 0$</div>
					</div>
					<div class="modal-footer">
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal"
						>닫기</button>
					</div>
				</div>
			</div>
		</div>

		<!-- JavaScript -->
		<script>
			async function fetchOrderDetails(BasketID) { try { const response =
			await fetch('/main/purchaseHistory/details', { method: 'POST',
			headers: { 'Content-Type': 'application/json', }, body:
			JSON.stringify({ BasketID }), }); const data = await
			response.json(); if (response.ok) { const tableBody =
			document.getElementById('order-details'); tableBody.innerHTML = '';
			let totalPrice = 0; data.books.forEach((book) => { const row = `
			<tr> <td>${book.Book_ISBN}</td> <td>${book.Title}</td>
			<td>${book.Number}</td> <td>${book.Price}$</td> </tr> `;
			tableBody.innerHTML += row; totalPrice +=
			Math.round(Number(book.Price) * book.Number * 100) / 100; });
			totalPrice = Math.round(totalPrice * 100) / 100; const
			totalPriceElement = document.getElementById('total-price');
			totalPriceElement.innerText = `합계: ${totalPrice}$`; } else {
			alert('세부 정보를 가져오는 데 실패했습니다.'); } } catch (error) {
			console.error('Error:', error); alert('오류가 발생했습니다.'); } }
		</script>

		<!-- Bootstrap JS -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		></script>
	</body>
</html>