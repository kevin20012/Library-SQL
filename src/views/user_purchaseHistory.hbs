<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>êµ¬ë§¤ ì´ë ¥</title>
		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<style>
			body { font-family: Arial, sans-serif; } .container { margin-top:
			30px; } .table th { background-color: #f8f9fa; font-weight: bold; }
			.table td, .table th { vertical-align: middle !important; /* ìˆ˜ì§
			ì •ë ¬ ê°€ìš´ë°ë¡œ ì„¤ì • */ } .no-data { text-align: center; font-size:
			1.2rem; color: #6c757d; } .navbar-custom { background-color:
			#f8f9fa; border-bottom: 1px solid #e5e5e5; } .user-info { font-size:
			1.2rem; font-weight: bold; } .navbar-custom a.navbar-brand {
			text-decoration: none; color: #343a40; display: flex; align-items:
			center; font-size: 1rem; } .navbar-custom a.navbar-brand:hover {
			color: #0d6efd; } .navbar-custom .fs-1 { font-size: 2rem;
			margin-right: 10px; }
		</style>
	</head>
	<body>
		<!-- Navigation Bar -->
		<nav class="navbar navbar-expand-lg navbar-custom">
			<div class="container-fluid">
				<!-- User Info -->
				<div class="d-flex align-items-center user-info">
					<a href="/main" class="navbar-brand">
						<span class="me-2">â†</span>
					</a>
					<span id="user-name">{{user.name}} ë‹˜ êµ¬ë§¤ ì´ë ¥ ğŸ’¸</span>
				</div>
			</div>
		</nav>

		<div class="container">
			<!-- êµ¬ë§¤ ì´ë ¥ í‘œ -->
			{{#if orders.length}}
				<table class="table table-bordered table-striped text-center">
					<thead>
						<tr>
							<th>êµ¬ë§¤ ID</th>
							<th>êµ¬ë§¤ ë‚ ì§œ</th>
							<th>ìƒíƒœ</th>
							<th>ìì„¸íˆ ë³´ê¸°</th>
						</tr>
					</thead>
					<tbody>
						{{#each orders}}
							<tr>
								<td>{{BasketID}}</td>
								<td>{{Order_date}}</td>
								<td><span class="badge bg-success">êµ¬ë§¤ ì™„ë£Œ</span></td>
								<td>
									<button
										class="btn btn-info"
										onclick="fetchOrderDetails('{{BasketID}}')"
										data-bs-toggle="modal"
										data-bs-target="#orderModal"
									>ë³´ê¸°</button>
								</td>
							</tr>
						{{/each}}
					</tbody>
				</table>
			{{else}}
				<p class="no-data">êµ¬ë§¤ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
			{{/if}}
		</div>

		<!-- Modal -->
		<div
			class="modal fade"
			id="orderModal"
			tabindex="-1"
			aria-labelledby="orderModalLabel"
			aria-hidden="true"
		>
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="orderModalLabel">êµ¬ë§¤ ìƒì„¸
							ì •ë³´</h5>
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="modal"
							aria-label="Close"
						></button>
					</div>
					<div class="modal-body">
						<table class="table table-bordered text-center">
							<thead>
								<tr>
									<th>Book ISBN</th>
									<th>ì œëª©</th>
									<th>ìˆ˜ëŸ‰</th>
									<th>ê°œë‹¹ ê°€ê²©</th>
								</tr>
							</thead>
							<tbody id="order-details">
								<!-- ì±… ì •ë³´ê°€ ë™ì ìœ¼ë¡œ ì±„ì›Œì§ˆ ì˜ì—­ -->
							</tbody>
						</table>
						<div
							id="total-price"
							style="text-align: right; margin-right: 20px;"
						>í•©ê³„: 0$</div>
					</div>
					<div class="modal-footer">
						<button
							type="button"
							class="btn btn-secondary"
							data-bs-dismiss="modal"
						>ë‹«ê¸°</button>
					</div>
				</div>
			</div>
		</div>

		<!-- JavaScript -->
		<script>
			async function fetchOrderDetails(BasketID) { try { const response =
			await fetch('/main/purchaseHistory/details', { method: 'POST',
			headers: { 'Content-Type': 'application/json', }, body:
			JSON.stringify({ BasketID }), }); const data = await
			response.json(); if (response.ok) { const tableBody =
			document.getElementById('order-details'); tableBody.innerHTML = '';
			let totalPrice = 0; data.books.forEach((book) => { const row = `
			<tr> <td>${book.Book_ISBN}</td> <td>${book.Title}</td>
			<td>${book.Number}</td> <td>${book.Price}$</td> </tr> `;
			tableBody.innerHTML += row; totalPrice +=
			Math.round(Number(book.Price) * book.Number * 100) / 100; });
			totalPrice = Math.round(totalPrice * 100) / 100; const
			totalPriceElement = document.getElementById('total-price');
			totalPriceElement.innerText = `í•©ê³„: ${totalPrice}$`; } else {
			alert('ì„¸ë¶€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); } } catch (error) {
			console.error('Error:', error); alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); } }
		</script>

		<!-- Bootstrap JS -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		></script>
	</body>
</html>